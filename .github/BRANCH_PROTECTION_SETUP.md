# Настройка защиты веток GitHub

Для обеспечения того, чтобы Pull Request'ы не могли быть смержены без успешного прохождения всех проверок, необходимо настроить защиту веток в настройках репозитория.

## Инструкция по настройке

### 1. Перейдите в настройки репозитория

1. Откройте ваш репозиторий на GitHub
2. Перейдите в раздел **Settings** (Настройки)
3. В левом меню выберите **Branches** (Ветки)

### 2. Добавьте правило защиты для ветки `main`

1. Нажмите **Add rule** (Добавить правило)
2. В поле **Branch name pattern** введите `main`
3. Включите следующие опции:

#### Обязательные настройки:

- ✅ **Require a pull request before merging**

  - ✅ **Require approvals**: 1 (или больше, по вашему усмотрению)
  - ✅ **Dismiss stale reviews when new commits are pushed**
  - ✅ **Require review from code owners** (если у вас есть CODEOWNERS файл)

- ✅ **Require status checks to pass before merging**

  - ✅ **Require branches to be up to date before merging**
  - В разделе **Status checks that are required** добавьте:
    - `Backend`
    - `Frontend`

- ✅ **Require conversation resolution before merging**

- ✅ **Require signed commits** (рекомендуется для безопасности)

- ✅ **Require linear history** (рекомендуется для чистоты истории)

- ✅ **Include administrators** (применять правила даже к администраторам)

### 3. Добавьте правило защиты для ветки `develop` (если используется)

Повторите те же шаги для ветки `develop`, если вы используете GitFlow или подобную стратегию ветвления.

### 4. Настройка обязательных статус-чеков

После первого запуска CI workflow'ов, GitHub автоматически обнаружит статус-чеки. Вы сможете выбрать их из списка в настройках защиты веток.

**Обязательные статус-чеки для настройки:**

- `Backend`
- `Frontend`

### 5. Дополнительные рекомендации

#### Создайте файл CODEOWNERS (опционально)

Создайте файл `.github/CODEOWNERS` для автоматического назначения ревьюеров:

```
# Все изменения требуют ревью от владельцев
* @yourusername

# Backend изменения
/backend/ @backend-team

# Frontend изменения
/frontend/ @frontend-team

# CI/CD изменения
/.github/ @devops-team

# Документация
*.md @tech-writers
```

#### Настройте уведомления

1. Перейдите в **Settings** → **Notifications**
2. Настройте уведомления для:
   - Failed CI builds
   - Pull request reviews
   - Security alerts

### 6. Проверка настроек

После настройки защиты веток:

1. Создайте тестовый Pull Request
2. Убедитесь, что кнопка **Merge** неактивна до прохождения всех проверок
3. Проверьте, что все CI jobs запускаются и выполняются

## Результат

После настройки:

- ❌ Невозможно напрямую пушить в protected ветки
- ❌ Невозможно смержить PR без прохождения всех проверок
- ❌ Невозможно смержить PR без ревью (если настроено)
- ✅ Все изменения проходят через CI/CD pipeline
- ✅ Гарантированное качество кода в main ветке

## Troubleshooting

### Проблема: Статус-чеки не появляются в списке

**Решение**: Запустите CI workflow хотя бы один раз, затем обновите настройки защиты веток.

### Проблема: CI fails на Windows line endings

**Решение**: Добавьте в `.gitattributes`:

```
* text=auto
*.sh text eol=lf
```

### Проблема: Тесты падают из-за отсутствия environment variables

**Решение**: Проверьте, что все необходимые переменные окружения настроены в workflow файлах.
